<!DOCTYPE html>
<HTML>
<HEAD>
<meta charset="UTF-8">
<title>Lenia</title>
<link rel="icon" type="image/png" href="logo.png">

<script type="text/javascript" src="Lenia-LifeForms.js"></script>
<script type="text/javascript" src="libs/MersenneTwister19937.js"></script>
<script type="text/javascript" src="libs/jsgif/LZWEncoder.js"></script>
<script type="text/javascript" src="libs/jsgif/NeuQuant.js"></script>
<script type="text/javascript" src="libs/jsgif/GIFEncoder.js"></script>
<script type="text/javascript" src="libs/plotly-latest.min.js"></script>
<!-- https://plot.ly/javascript/ -->

<!-- KaTeX local -->
<!--<link type="text/css" rel="stylesheet" href="libs/katex/katex.min.css">
<script type="text/javascript" src="libs/katex/katex.min.js"></script>
<script type="text/javascript" src="libs/katex/contrib/auto-render.min.js"></script>-->
<!-- KaTeX remote -->
<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.css">
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/katex.min.js"></script>
<script src="https://cdnjs.cloudflare.com/ajax/libs/KaTeX/0.7.1/contrib/auto-render.min.js"></script>
<script>
document.addEventListener("DOMContentLoaded", function (e) {
	renderMathInElement(document.body, { delimiters: [ {left: "$", right: "$", display: false} ] });
});
</script>

<STYLE>
BODY, TD, TH, .normal { font:12px sans-serif; color:#399; white-space:nowrap; }
A { color:#36c; }
A[target=_blank] { background-position:center right; background-repeat:no-repeat; padding-right:13px; background-image:linear-gradient(transparent,transparent),
	url(data:image/svg+xml,%3C%3Fxml%20version%3D%221.0%22%20encoding%3D%22UTF-8%22%20standalone%3D%22no%22%3F%3E%3Csvg%20xmlns%3D%22http%3A%2F%2Fwww.w3.org%2F2000%2Fsvg%22%20width%3D%2212%22%20height%3D%2212%22%3E%3Cpath%20fill%3D%22%23fff%22%20stroke%3D%22%2306c%22%20d%3D%22M1.5%204.518h5.982V10.5H1.5z%22%2F%3E%3Cpath%20d%3D%22M5.765%201H11v5.39L9.427%207.937l-1.31-1.31L5.393%209.35l-2.69-2.688%202.81-2.808L4.2%202.544z%22%20fill%3D%22%2306f%22%2F%3E%3Cpath%20d%3D%22M9.995%202.004l.022%204.885L8.2%205.07%205.32%207.95%204.09%206.723l2.882-2.88-1.85-1.852z%22%20fill%3D%22%23fff%22%2F%3E%3C%2Fsvg%3E); }  /* from wikipedia */
A.animalDemo { color:#c3c; }
TH { text-decoration:underline; text-align:center; }
TAB { padding-left:20px; }
HR { height:2px; border:0px; background-color:#9dd; }
.mainTitle { font:italic 32px serif; color:#09f; }
.subTitle { font:bold italic 18px serif; color:#09f; }
.infoText { font:14px sans-serif; color:#036; border:solid 1px #bdf; line-height:1.3em; padding:10px; white-space:normal; 
		width:550px; height:400px; overflow:auto; }
.status { font:12px sans-serif; color:#09f; white-space:normal; }
.codeName { font:18px serif; }
.engName { font:italic 18px serif; }
.chiName { font:16px "MS UI Gothic"; }
.colliderStatus { background-color:#faa; color:#000; font-weight:bold; }
.field { border:solid 1px #ddf; width:256px; height:256px; }
#ct { display:none; }
.graph { border:solid 1px #fdd; }
.graphTable TD { color:#d99; }
.gif { border:solid 1px #ddf; }
.stat { border:solid 1px #beb; cursor:pointer; }
.val { padding-left:10px; padding-right:10px; width:60px; }
.num, .val { font:14px monospace; color:#369; }
.num { background-color:#eef; padding:0 3px; }
/*HTML, BODY, .scrollOut { height:100%; }
.scrollIn { height:100%; overflow:auto; }*/
.animalWindow { font:12px sans-serif; color:#369; background-color:#fff; border:solid 1px #fcf; padding:0px;
		width:400px; height:250px; overflow:auto; }
UL.animalList, UL.animalList UL { padding-left:10px; }
UL.animalList LI { list-style-type:none; position:relative; }
UL.animalList LI.group > DIV { font-weight:bold; background-color:#fef; border-bottom:solid 2px #fbf; padding-top:0.2em; }
UL.animalList LI.closed > DIV { background-color:#fcf; border-bottom:solid 2px #e9e; }
UL.animalList LI.closed > UL { display:none; }
UL.animalList LI.group > DIV:before { content:'[−] '; }
UL.animalList LI.closed > DIV:before { content:'[+] '; }
UL.animalList LI.group > DIV:hover { background-color:#cef !important; }
UL.animalList LI.action:hover,
UL.animalList LI.closed > DIV:hover { background-color:#6cf !important; }
UL.animalList LI.action, UL.animalList LI.group > DIV { cursor:pointer; }
UL.animalList LI.selected { background-color:#39c; color:#fff; }
.layerSt { color:#bdf; }
IMG.catImg { border:0px; zoom:50%; -moz-transform:scale(0.5); opacity:0.4; filter:alpha(opacity=40); cursor:pointer; }
IMG.catImg:hover { opacity:1; filter:none; }
INPUT[type=button] { font:12px sans-serif; padding:.2em .5em; border:none; border-radius:2px; background-color:#ddd; }
INPUT[type=button].btnOption { }
INPUT[type=button].btnRun { background-color:#afd; }
INPUT[type=button].btnField { background-color:#adf; }
INPUT[type=button].btnSoliton { background-color:#fcf; }
INPUT[type=button].btnDisplay { background-color:#dda; }
INPUT[type=button].btnHigh { background-color:#daf; font-weight:bold; }
INPUT[type=button].btnCenterOn, INPUT[type=button].btnAddOn, INPUT[type=button].btnMirrorOn, INPUT[type=button].btnCollideOn, INPUT[type=button].btnGIFOn { background-color:#faa; }
INPUT[type=button].btnInfo { font-weight:bold; cursor:default; }
INPUT[type=button].btnKey { background-color:#eee; border:solid 1px #bbb; border-radius:5px; padding:.1em .4em; box-shadow:.2em .2em .2em rgba(0,0,0,.1); }
INPUT, SELECT, LABEL { cursor:pointer; }
#copyArea { width:0px; height:0px; border:0px; }
CANVAS, IMG { image-rendering: pixelated; image-rendering: optimizeSpeed;
	image-rendering: -moz-crisp-edges; -ms-interpolation-mode: nearest-neighbor; }
.frac { display:inline-block; font-size:100%; text-align:center; vertical-align:middle; }
.frac > sup { display:block; font:inherit; border-bottom:solid 1px; }
.frac > sub { display:block; font:inherit; }
.frac > span { display:none; }
.cubeTable TD { width:20px; font:8px sans-serif; color:#666; text-align:center; }
.cubeCell { width:20px; font:8px sans-serif; color:#666; text-align:center; background-color:#eee; border:solid 2px #fff; cursor:pointer; }
.cubeEmpty { background-color:#fff; }
.cubeExist { background-color:#5df !important; }
.cubeNonExist { background-color:#fd5 !important; }
.cubeBorder { border:solid 2px #ccc; }
.cubeHover { border:solid 2px #e6e; }
.cubeSel { font-weight:bold !important; border:solid 2px #66e; }
.cubeTop { border-bottom:0px; }
.cubeBottom { border-top:0px; }
.plotDiv { width:650px; height:400px; border:solid 1px #bdf;}
</STYLE>
</HEAD>

<BODY onload="BodyOnload()">
<TABLE cellpadding=5 cellspacing=0 class="scrollOut">
<TR valign="top">
<!-- LEFT -->
<TD>

	<table cellpadding=1 cellspacing=0><tr>
	<td id="canvas1td2">Field = $\color{magenta}f(\mathbf x)$</td>
	<td id="canvas2td2">
	<span id="panel2_1">Delta = $\color{magenta}d(\color{magenta}{k \ast f}(\mathbf x))$</span>
	<span id="panel2_2" style="display:none;">Period (arrow = overall)</span>
	</td>
	</tr><tr>
	<td id="canvas1td1"><canvas id="canvas1" class="field" onclick="actionKey=ALT+'F'"></canvas></td>
	<td id="canvas2td1"><canvas id="canvas2" class="field" onclick="actionKey=ALT+'F'"></canvas></td>
	</tr><tr>
	<td id="canvas3td1"><canvas id="canvas3" class="field" onclick="actionKey=ALT+'F'"></canvas></td>
	<td id="canvas4td1"><canvas id="canvas4" class="field" onclick="actionKey=ALT+'F'"></canvas></td>
	</tr><tr>
	<td id="canvas3td2">
	<span id="panel3_1">Neighbor sum = $\color{magenta}{k \ast f}(\mathbf x)$</span>
	<span id="panel3_2" style="display:none;">Average</span>
	</td>
	<td id="canvas4td2">
	<span id="panel4_1">Kernel = $\color{magenta}k(\mathbf u)$</span>
	<span id="panel4_2" style="display:none;">Value</span>
	<!--
	<span id="panel3_2" style="display:none;">FFT of Field = $| \mathcal F (f) (\mathbf x) |$</span>
	<span id="panel4_2" style="display:none;">FFT of Kernel = $| \mathcal F (k) (\mathbf u) |$</span>
	-->
	</td></tr><tr>
	<td><canvas id="canvasT" class="field" style="display:none;"></canvas></td>
	</tr></table>
	<br>
	<div id="txt_status" class="status"></div>
	<textarea id="copyArea"></textarea>
	<div id="txt_debug"></div>

</TD>
<!-- RIGHT -->
<TD>
<TABLE cellpadding=0 cellspacing=0 class="scrollOut">
<!-- RIGHT UPPER -->
<TR>
<TD colspan=9>

	<input type="button" value="Controls" id="CtrlBtn" title="Show controls panel (1)" onclick="actionKey='1';this.blur();"> &nbsp;
	<input type="button" value="Calculations" id="CalcBtn" title="Show calculations panel (2)" onclick="actionKey='2';this.blur();"> &nbsp;
	<input type="button" value="Statistics" id="StatBtn" title="Show statistics panel (3)" onclick="actionKey='3';this.blur();"> &nbsp;
	<input type="button" value="3D Plot" id="PlotBtn" title="Show 3D surface plot panel (4)" onclick="actionKey='4';this.blur();"> &nbsp;
	<input type="button" value="&beta; Cube" id="CubeBtn" title="Show &beta; parameters adjustment panel (5)" onclick="actionKey='5';this.blur();"> &nbsp;
	<input type="button" value="About" id="InfoBtn" title="Show information panel (grave(`))" onclick="actionKey=GRAVE;this.blur();"> &nbsp;
	<br><br>

	<table cellpadding=3 cellspacing=0>
	<tr><td valign="top">Params:</td><td>

	<table cellpadding=3 cellspacing=0>
	<tr><td width=150>
		<input type="button" value="+" class="btnAddOff" title="Increase center of delta function (Q or keypad 7)" onclick="actionKey='Q';this.blur();">
		<input type="button" value="−" class="btnAddOff" title="Decrease center of delta function (A or keypad 4)" onclick="actionKey='A';this.blur();">
		&nbsp; $\color{blue}\mu$ = <span id="txt_c" class="num"></span>
	</td><td width=250 colspan=2>
		<input type="button" value="+" title="Increase space resolution ([shift] R or keypad +)" onclick="actionKey='R';this.blur();">
		<input type="button" value="−" title="Decrease space resolution ([shift] F or keypad -)" onclick="actionKey='F';this.blur();">
		&nbsp; $\color{blue}R$ = <span id="txt_R" class="num"></span> cells per kernel radius</i>
	</td><td width=250>
		Field: <span id="txt_size" class="num"></span> cells, each <span id="txt_pixel" class="num"></span> pixels

	</td></tr><tr><td>
		<input type="button" value="+" class="btnAddOff" title="Increase width of delta function (W or keypad 8)" onclick="actionKey='W';this.blur();">
		<input type="button" value="−" class="btnAddOff" title="Decrease width of delta function (S or keypad 5)" onclick="actionKey='S';this.blur();">
		&nbsp; $\color{blue}\sigma$ = <span id="txt_w" class="num"></span>
	</td><td colspan=2>
		<input type="button" value="+" title="Dilute time (T or keypad *)" onclick="actionKey='T';this.blur();">
		<input type="button" value="−" title="Concentrate time (G or keypad /)" onclick="actionKey='G';this.blur();">
		&nbsp; $\color{blue}T$ = <span id="txt_ts" class="num"></span> steps per unit time</i>
	</td><td>
		CPU: <span id="txt_fps" class="num"></span> fps

	</td></tr><tr><td>
		<input type="button" value="&darr;" title="Decrease adjustment step (E or keypad 9)" onclick="actionKey='E';this.blur();">
		<input type="button" value="&uarr;" title="Increase adjustment step (D or keypad 6)" onclick="actionKey='D';this.blur();">
		&nbsp; &nbsp; &nbsp; &plusmn; <span id="txt_adj" class="num"></span>
	</td><td width=50>
		<input type="button" value="+" class="btnAddOff" title="Increase peak height 1 (Y)" onclick="actionKey='Y';this.blur();">
		<input type="button" value="+" class="btnAddOff" title="Increase peak height 2 (U)" onclick="actionKey='U';this.blur();">
		<input type="button" value="+" class="btnAddOff" title="Increase peak height 3 (I)" onclick="actionKey='I';this.blur();">
		<input type="button" value="+" class="btnAddOff" title="Increase peak height 4 (O)" onclick="actionKey='O';this.blur();"><br>
		<input type="button" value="−" class="btnAddOff" title="Decrease peak height 1 (H)" onclick="actionKey='H';this.blur();">
		<input type="button" value="−" class="btnAddOff" title="Decrease peak height 2 (J)" onclick="actionKey='J';this.blur();">
		<input type="button" value="−" class="btnAddOff" title="Decrease peak height 3 (K)" onclick="actionKey='K';this.blur();">
		<input type="button" value="−" class="btnAddOff" title="Decrease peak height 4 (L)" onclick="actionKey='L';this.blur();">
	</td><td>
		&nbsp; $\color{blue}{\beta}$ = <span id="txt_B" class="num"></span><br>
		&nbsp; $\color{blue}{\eta}$ = <span id="txt_E" class="num"></span>
	</td><td width=120>
		$\color{blue}{\Delta t}$ = <span id="txt_dt" class="num"></span> $\mu s$<br>
		$t$ = <span id="txt_t" class="num"></span> $\mu s$

	</td></tr></table>
	
	</td></tr></table>

	<table cellpadding=0 cellspacing=0>
	<tr><td>
	Calc stats:
	<input type="button" class="btnOption" value="Reset" title="Reset stats (alt+B)" onclick="actionKey=ALT+'B';this.blur();"> &nbsp;
	<input type="button" class="btnOption" id="optCalc" value="" title="Calculation level (alt+N)" onclick="actionKey=ALT+'N';this.blur();"></td>
	<td align="center"><input type="button" class="btnOption" id="optValue" value="" title="Change values displayed (alt+M)" onclick="actionKey=ALT+'M';this.blur();"></td>
	<td>
		Period: <span id="txt_period" class="num"></span> $\mu s$
	</td>
	</tr>
	<tr id="s_tr"></tr>
	</table>

</TD>
</TR>
<!-- RIGHT LOWER -->
<TR class="scrollOut">
<TD id="InfoPanel" valign="top" class="scrollOut" style="display:none">
<DIV class="scrollIn">

	<br>
	<table cellpadding=0 cellspacing=0>
	<tr valign="middle"><td><img src="logo.png"></td><td><div class="mainTitle">Lenia</div></td></tr>
	<tr><td></td><td><div class="subTitle">
	Artificial Life in 2D Continuous Cellular Automata<br>
	by Bert Chan
	</div></td></tr>
	<tr><td colspan=2>
	<br>
	<div class="infoText">
	This program demonstrates a generalization of continuous cellular automata called <b>Lenia</b>,
	where a number of naturalistic life forms reside in the virtual world.
	<p>
	<b>How to use</b>
	<p>
	<li><b>Field window</b> 
		- shows the current state of cellular automata.
	<li><b>Other windows</b> 
		- show different stages of calculation.
	<li>Click to change to statistics diagrams.
	<p>
	<input type="button" value="Controls" class="btnHigh btnInfo"> tab 
		- lists all controls.
	<li><input type="button" value="Enter" class="btnKey btnInfo"> - start / stop calculations; 
		<input type="button" value="Space" class="btnKey btnInfo"> - calculate one step.
	<li><input type="button" value="Preset" class="btnRun btnInfo"> buttons 
		- run other CAs including SmoothLife and the Game of Life.
	<li><input type="button" value="Field" class="btnField btnInfo"> buttons 
		- manipulate the field (add random cells, move/rotate, resize, etc).
	<li><input type="button" value="Soliton" class="btnSoliton btnInfo"> buttons & list
		- load life forms (enlarged by <input type="button" value="xN" class="btnInfo"> option).
	<li><input type="button" value="Display" class="btnDisplay btnInfo"> buttons 
		- change color scheme, toggle auto center, etc.
	<li><input type="button" value="Ctrl" class="btnKey btnInfo">/<input type="button" value="&#8984;" class="btnKey btnInfo">+<input type="button" value="C" class="btnKey btnInfo">
		- copy cells from the field (controlled by <input type="button" value="Copy" class="btnOption btnInfo"> option).
	<li><input type="button" value="Ctrl" class="btnKey btnInfo">/<input type="button" value="&#8984;" class="btnKey btnInfo">+<input type="button" value="V" class="btnKey btnInfo">
		- paste cells into the field.
	<p>
	<input type="button" value="Calculations" class="btnHigh btnInfo"> tab 
		- shows the details of calculation.
	<li><input type="button" value="+" class="btnParam btnInfo"> <input type="button" value="−" class="btnParam btnInfo">
		tweak parameters or <input type="button" value="Switch" class="btnRun btnInfo"> functions 		
		to see changes in the life form.
	<li><input type="button" value="Repeat" class="btnField btnInfo"> button 
		- restart cells if things break down.
	<li><input type="button" value="Repeat" class="btnOption btnInfo"> option 
		- observe the same cells while tweaking parameters.
	<p>
	<input type="button" value="Statistics" class="btnHigh btnInfo"> tab 
		- shows various real-time statistics, find period, etc.
	<p>
	Many more functions --- try it yourself!
	<p>
	<b>Background</b>
	<p>
	<b><a target="_blank" href="https://en.wikipedia.org/wiki/Cellular_automaton">Cellular automata</a> (CA)</b>
	is a simple set of mathematical rules that could produce a myriad of complex patterns.
	In the most popular CA <b><a target="_blank" href="https://en.wikipedia.org/wiki/Conway%27s_Game_of_Life">Game of Life</a> (GoL)</b>,
	interesting patterns range from the tiny <a href="#" onclick="SelectAnimalCode('~(glider)'); return false;">glider</a>,
	a <a href="#" onclick="SelectAnimalCode('~(ggun)'); return false;">gun that shoots gliders</a>,
	to extreme constructions capable of simulating 
	<a target="_blank" href="https://www.youtube.com/watch?v=3NDAZ5g4EuU">a digital clock (video)</a>, 
	<a target="_blank" href="https://www.youtube.com/watch?v=My8AsV7bA94">a computer (video)</a>,
	and even <a target="_blank" href="https://www.youtube.com/watch?v=xP5-iIeKXE8">the CA itself (video)</a>.
	<p>
	The discrete nature of <b>GoL</b> has been taken to continuous limits in other CAs.
	<b><a target="_blank" href="https://doi.org/10.1016/S0167-2789(03)00155-6">Larger than Life</a> (LtL)</b>
	took a larger radius of neighborhood,
	<b><a target="_blank" href="https://doi.org/10.1016/j.tcs.2006.11.019">RealLife</a></b>
	took the radius to infinity and approached continuous space (theoretically), and
	<b><a target="_blank" href="http://www.conwaylife.com/wiki/SmoothLife">SmoothLife</a></b>
	explored continuity and smoothness in cell values, space and time.
	They produce more life-like patterns, 
	like the <a href="#" class="animalDemo" onclick="PresetAnimal({fsize:7, animalCode:'~(sbug)'}); return false;">"bug with stomach"</a> that moves in any direction.
	<p>
	<b>Lenia</b>
	<p>
	Here in <b>Lenia</b>, the neighborhood and updating rules are generalized into "kernel" and "delta" functions.
	Like in SmoothLife, every cell has <b>continuous value</b> from 0.00 to 1.00, 
	<b>continuous space-time</b> can be approached by increasing space resolution <i style="color:blue">R</i> and time resolution <i style="color:blue">T</i>.
	Length, time and mass are measured in units <i>&mu;m</i>, <i>&mu;s</i> and <i>&mu;g</i>, respectively.
	<p>
	<b>Life forms</b>
	<p>
	After intensive search and experimentations,
	several dozens of stable life forms (or "<b>solitons</b>") were discovered.
	They were then given "scientific names" and being categorized similar to 
	<a target="_blank" href="https://en.wikipedia.org/wiki/Taxonomy_(biology)">biological taxonomy</a> and 
	<a target="_blank" href="https://en.wikipedia.org/wiki/IUPAC_nomenclature_of_organic_chemistry#Alkanes">organic chemistry</a>.
	The "bug with stomach" in LtL/RealLife/SmoothLife turns out to be 
	<a href="#" class="animalDemo" onclick="PresetAnimal({fsize:7, animalCode:'S1'}); return false;"><i>Scutium solidus</i></a> 
	within the order <b>Scutiformes</b>,
	and the <a target="_blank" href="https://www.youtube.com/watch?v=iyl5wyTFjJ8&index=30&list=PL69EDA11384365494">eyeball-like bug (video)</a> 
	is very similar to
	<a href="#" class="animalDemo" onclick="PresetAnimal({fsize:7, animalCode:'O2'}); return false;"><i>Orbium unicaudatus</i></a>
	within the order <b>Orbiformes</b>.
	Other known orders include the wings-bearing <b>Pterifera</b>, 
	the single-ring <b>Anuliformes</b>, and the double-spiral <b>Heliciformes</b>.
	Sizes range from single-sac
	<a href="#" class="animalDemo" onclick="PresetAnimal({fsize:7, animalCode:'O2'}); return false;"><i>Orbium</i></a> or 
	<a href="#" class="animalDemo" onclick="PresetAnimal({fsize:7, animalCode:'PG2'}); return false;"><i>Gyropteron</i></a> to multi-sac 
	<a href="#" class="animalDemo" onclick="PresetAnimal({fsize:8, animalCode:'H9'}); return false;"><i>Nonahelicium</i></a> or 
	<a href="#" class="animalDemo" onclick="PresetAnimal({fsize:8, animalCode:'P24'}); return false;"><i>Tetracosapteryx</i></a>.
	<p>
	Feel free to discover your own new species!
	If you found one, please share with us at <a href="mailto:albert.chak@gmail.com">albert.chak@gmail.com</a>
	(You can copy the cells by
	<input type="button" value="Ctrl" class="btnKey btnInfo">/<input type="button" value="&#8984;" class="btnKey btnInfo">+<input type="button" value="C" class="btnKey btnInfo">
	and paste the Unicode text in the email).
	<p>
	<b>Powered by</b>
	<p>
	<ul>
	<li>FFT algorithm: <a target="_blank" href="https://0fps.net/2012/11/19/conways-game-of-life-for-curved-surfaces-part-1/">0fps.net</a><br>
	<li>Maths display: <a target="_blank" href="https://khan.github.io/KaTeX/">KaTeX</a> by Khan Academy<br>
	<li>3D surface plot: <a target="_blank" href="https://plot.ly/javascript/">Plotly.js</a> by Plotly<br>
	<li>GIF encoder: <a target="_blank" href="https://github.com/antimatter15/jsgif">jsgif</a> by Kevin Kwok<br>
	<li>Hu's and Flusser's image invariants:
	<ul><li>
		<a target="_blank" href="https://en.wikipedia.org/wiki/Image_moment">Wikipedia</a>
		<a target="_blank" href="https://doi.org/10.1109/TIT.1962.1057692">Hu (1962)</a>
		<li>
		<a target="_blank" href="https://doi.org/10.1016/S0031-3203(99)00127-2">Flusser (2000)</a>
		<a target="_blank" href="https://scholar.google.com.hk/scholar?cluster=9616874577999778120">Barczak et al. (2007)</a>
	</ul>
	</ul>
	</div>
	</td></tr>
	</table>
	<br><br>
	<input type="button" value="Start playing!" class="btnHigh" onclick="actionKey='1';this.blur();">

</DIV>
</TD>
<TD id="CtrlPanel" valign="top" class="scrollOut" style="display:none">
<DIV class="scrollIn">

	<br>
	<table cellpadding=3 cellspacing=0>
	<tr><td>Run:</td><td>
	<input type="button" class="btnRun" value="Start/Stop" title="Start/stop running ([shift] Enter)" onclick="actionKey=ENTER;this.blur();"> &nbsp;
	<input type="button" class="btnRun" value="Once" title="Run one step only (Space)" onclick="actionKey=SPACE;this.blur();"> &nbsp;

	</td></tr><tr><td>Preset:</td><td>
	<input type="button" class="btnRun" value="Lenia" title="Rule for Lenia (6)" onclick="actionKey='6';this.blur();"> &nbsp;
	<input type="button" class="btnRun" value="SmoothLife" title="Rule for SmoothLife (7)" onclick="actionKey='7';this.blur();"> &nbsp;
	<input type="button" class="btnRun" value="Game of Life" title="Rule for Conway's Game of Life (8)" onclick="actionKey='8';this.blur();"> &nbsp;
	<input type="button" class="btnRun" value="Default" title="Default settings (9)" onclick="actionKey='9';this.blur();"> &nbsp;
	<input type="button" class="btnRun" value="Large" title="Large field (0)" onclick="actionKey='0';this.blur();"> &nbsp;

	</td></tr><tr><td>Field:</td><td>
	<input type="button" class="btnField" value="Random" title="Add random in field ([shift] N)" onclick="actionKey='N';this.blur();"> &nbsp;
	<input type="button" class="btnField" value="Again" title="Add random using same seed (M or keypad .)" onclick="actionKey='M';this.blur();"> &nbsp;
	<input type="button" class="btnField" value="Clear" title="Clear field (Del)" onclick="actionKey=DEL;this.blur();"> &nbsp;
	<input type="button" class="btnField btnCenterOff btnCollideOff btnMirrorOff" value="Center" title="Center/rotate object in field ([shift] Quote('))" onclick="actionKey=QUOTE;this.blur();"> &nbsp;
	<input type="button" class="btnField btnAddOff btnCollideOff" value="Repeat" title="Repeat last add/paste (keypad 0)" onclick="actionKey=PAD+0;this.blur();"> &nbsp;

	</td></tr><tr><td></td><td>
	<table cellpadding=3 cellspacing=0><tr>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&#8596;" title="Flip field horizontally (PgUp/fn&uarr;)" onclick="actionKey=PGUP;this.blur();"></td>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&#8634;" title="Rotate field anti-clockwise ([shift] Home/fn&larr;)" onclick="actionKey=HOME;this.blur();"></td>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&uarr;" title="Move field up ([shift] &uarr;)" onclick="actionKey=UP;this.blur();"></td>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&#8635;" title="Rotate field clockwise ([shift] End/fn&rarr;)" onclick="actionKey=END;this.blur();"></td>
	<td><input type="button" class="btnField" value="&times;2" title="Double field (Slash(/))" onclick="actionKey=SLASH;this.blur();"></td>
	<td><input type="button" class="btnField btnMirrorOff" value="&#8696;" title="Mirror field horizontally/diagonally ([shift] Comma(,))" onclick="actionKey=COMMA;this.blur();"></td>
	<td style="text-align:right">Space</td>
	<td>
	<input type="button" class="btnField" value="−" title="Decrease space resolution (Left bracket([))" onclick="actionKey=LBRA;this.blur();">
	<input type="button" class="btnField" value="+" title="Increase space resolution (Right bracket(]))" onclick="actionKey=RBRA;this.blur();">
	<input type="button" class="btnField" value="0" title="Reset space resolution (Backslash(\))" onclick="actionKey=BKSLASH;this.blur();"></td>
	</tr><tr>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&#8597;" title="Flip field vertically (PgDn/fn&darr;)" onclick="actionKey=PGDN;this.blur();"></td>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&larr;" title="Move field left ([shift] &larr;)" onclick="actionKey=LEFT;this.blur();"></td>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&darr;" title="Move field down ([shift] &darr;)" onclick="actionKey=DOWN;this.blur();"></td>
	<td><input type="button" class="btnField btnCollideOff btnMirrorOff" value="&rarr;" title="Move field right ([shift] &rarr;)" onclick="actionKey=RIGHT;this.blur();"></td>
	<td><input type="button" class="btnField" value="&div;2" title="Halve field (shift+Slash(/))" onclick="actionKey=SLASH;actionShift=true;this.blur();"></td>
	<td><input type="button" class="btnField btnMirrorOff" value="&#10536;" title="Mirror field crossed (Dot(.))" onclick="actionKey=DOT;actionShift=true;this.blur();"></td>
	<td style="text-align:right">Pixel</td>
	<td>
	<input type="button" class="btnDisplay" value="−" title="Decrease pixels per cell (Left curly bracket({))" onclick="actionKey=LBRA;actionShift=true;this.blur();">
	<input type="button" class="btnDisplay" value="+" title="Increase pixels per cell (Right curly bracket(}))" onclick="actionKey=RBRA;actionShift=true;this.blur();">
	<input type="button" class="btnDisplay" value="0" title="Reset 1 cell = 1 pixel (Pipe(|))" onclick="actionKey=BKSLASH;actionShift=true;this.blur();"></td>
	</tr></table>

	</td></tr><tr><td>Soliton:</td><td>
	<input type="button" class="btnSoliton" value="Center" title="Add soliton at center (Z)" onclick="actionKey='Z';this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="Sprinkle" title="Add soliton at random (X)" onclick="actionKey='X';this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="Prev" title="Add previous soliton (C or keypad 1)" onclick="actionKey='C';this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="Next" title="Add next soliton (V or keypad 2)" onclick="actionKey='V';this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="[+]All" title="Expand all soliton groups" onclick="actionKey=INT+3;this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="[−]All" title="Collapse all soliton groups" onclick="actionKey=INT+4;this.blur();"> &nbsp;
	Options:
	<input type="button" class="btnOption" id="optAnimalX" value="" title="Enlarge soliton when added (B or keypad 3)" onclick="actionKey='B';this.blur();">

	</td></tr><tr><td> </td><td>
	<!--
	<select id="AnimalList" class="animalList" size=15 onclick="SelectAnimalNext(event.shiftKey)"></select>
	-->
	<table cellpadding=3 cellspacing=0 id="Catalogue"></table>
	<div id="AnimalWindow" class="animalWindow">
		<ul id="AnimalList" class="animalList"></ul>
	</div>

	</td></tr><tr><td>Display:</td><td>
	Auto <input type="button" class="btnDisplay btnCenterOff" id="optCenter" value="" title="Auto center/rotate/mirror object in field (alt+A)" onclick="actionKey=ALT+'A';this.blur();"> &nbsp;
	Colors <input type="button" class="btnDisplay" id="optColor" value="" title="Change color scheme (alt+S)" onclick="actionKey=ALT+'S';this.blur();"> &nbsp;
	Aid <input type="button" class="btnDisplay" id="optAid" value="" title="Toggle visual aids (alt+D)" onclick="actionKey=ALT+'D';this.blur();"> &nbsp;
	Windows <input type="button" class="btnDisplay" id="optWindows" value="" title="Switch window set (alt+F or click window)" onclick="actionKey=ALT+'F';this.blur();">
	</td></tr><tr><td> </td><td>
	$f(\mathbf x)$ <canvas id="swatches1"></canvas> &nbsp;
	$d(n)$ <canvas id="swatches2"></canvas>

	</td></tr><tr><td>Options:</td><td>
	Repeat <input type="button" class="btnOption btnAddOff btnMirrorOff btnCollideOff" id="optRepeat" value="" title="Repeat action on adjustments (alt+Z)" onclick="actionKey=ALT+'Z';this.blur();"> &nbsp;
	Allow copy <input type="button" class="btnOption" id="optFormat" value="" title="Set format of copied information (alt+X)" onclick="actionKey=ALT+'X';this.blur();"> format of
	<input type="button" class="btnOption" id="optCopy" value="" title="Allow copying information into clipboard (alt+C, <copy> ctrl+C, <copy table> ctrl+X, <paste> ctrl+V)" onclick="actionKey=ALT+'C';this.blur();"> &nbsp;
	GIF <input type="button" class="btnOption btnGIFOff" id="optGIF" value="" title="Start/finish animated GIF generation (alt+V)" onclick="actionKey=ALT+'V';this.blur();"> &nbsp;

	</td></tr></table>

</DIV>
</TD>
<TD id="CalcPanel" valign="top" class="scrollOut" style="display:none">
<DIV class="scrollIn">

	<br>
	<table cellpadding=3 cellspacing=0><tr><td>
	<b>Space</b>: Kernel radius = $1 \mu m$ divided into $R$ cells, each cell $\Delta x = 1 / R$<tab/>[unit = $\mu m$]<br>
	<b>Time</b>: Unit time = $1 \mu s$ divided into $T$ steps, each step $\Delta t = 1 / T$<tab/>[unit = $\mu s$]<br>
	<b>Mass</b>: Mass density per cell = cell value 
	<span id="txt_value1">$f(\mathbf x) \in [0,1]$</span>
	<span id="txt_value2" style="display:none">$f(\mathbf x) \in [0,\infty)$</span>
	<input type="button" class="btnRun" value="Switch" title="Switch between limited and unlimited values (alt+G)" onclick="actionKey=ALT+'G';this.blur();">
	<tab/>[unit = $\mu g / \mu m^2$]<br>
	</td></tr><tr><td>
	<br>
	<hr>
	<u>Field transition</u>: <!--<b>additive</b> <i></i>--><br>
	<tab/>$\displaystyle \Delta \color{magenta}f(\mathbf x) = \color{magenta}d(\color{magenta}{k \ast f}(\mathbf x)) \cdot \color{blue}{\Delta t}$<br>
	<!--$\displaystyle f_{t+\Delta t}(\mathbf x) = f_t(\mathbf x) + \Delta t \cdot d(n(\mathbf x))$<br>-->

	</td></tr><tr><td>
	<br>
	<u>Delta</u>:
	<table cellpadding=1 cellspacing=0 class="graphTable">
		<tr><td colspan="4">$d(n)$</td></tr>
		<tr><td align="right" valign="top">1</td><td colspan="3" rowspan="3"><canvas id="graphD" class="graph"></canvas></td></tr>
		<tr><td align="right" valign="middle">0</td></tr>
		<tr><td align="right" valign="bottom">-1</td><td valign="bottom">&nbsp; $n$</td></tr>
		<tr><td> </td><td align="left" width="30%">0</td><td align="center" width="40%">0.5</td><td align="right" width="30%">1</td></tr>
	</table>

	</td></tr><tr><td>
	<u>Delta function</u>: <input type="button" class="btnRun" value="Switch" title="Switch delta function (alt+Q)" onclick="actionKey=ALT+'Q';this.blur();">
	<span id="nameD_gaus" style="display:none"><b>Gaussian</b> <i>(center $\color{blue}\mu$, standard deviation $\color{blue}\sigma$)</i></span>
	<span id="nameD_quad4" style="display:none"><b>polynomial</b> <i>(center $\color{blue}\mu$, lower width $3\color{blue}\sigma$, raised to the power $\color{blue}\alpha$)</i></span>
	<span id="nameD_trap" style="display:none"><b>trapezoidal</b> <i>(center $\color{blue}\mu$, upper width $\color{blue}\sigma$, lower width $4\color{blue}\sigma$)</i></span>
	<span id="nameD_stpz" style="display:none"><b>step</b> <i>(center $\color{blue}\mu$, width $2\color{blue}\sigma$)</i></span>
	<!--<span id="nameD_bimo4" style="display:none"><b>bimodal polynomial</b> <i>(raised to the power $\color{blue}\alpha$)</i></span>-->
	<br>
	<div id="eqD_gaus" style="display:none">
	<tab/>$\displaystyle \color{magenta}d(n) = 2 e^{- \ell^2/k} - 1 \quad \text{where } \ell=|n-\color{blue}\mu|, k=2\color{blue}\sigma^2$</div>
	<div id="eqD_quad4" style="display:none">
	<tab/>$\displaystyle \color{magenta}d(n) = \begin{cases}
		2 \left( 1 - \ell^2/k^2 \right)^\color{blue}\alpha - 1 & \quad \text{if } \ell \leq k \\
		-1 & \quad \text{otherwise}
	\end{cases} \quad \text{where } \ell=|n-\color{blue}\mu|, k=3\color{blue}\sigma$</div>
	<div id="eqD_trap" style="display:none">
	<tab/>$\displaystyle \color{magenta}d(n) = \begin{cases}
		1 & \quad \text{if } \ell \leq p\\
		2 \cdot \frac{q-\ell}{q-p} - 1 & \quad \text{if } p \leq \ell \leq q\\
		-1 & \quad \text{otherwise}
	\end{cases} \quad \text{where } \ell=|n-\color{blue}\mu|, p=\color{blue}\sigma/2, q=2\color{blue}\sigma$</div>
	<div id="eqD_stpz" style="display:none">
	<tab/>$\displaystyle \color{magenta}d(n) = \begin{cases}
		1 & \quad \text{if } \ell \leq \color{blue}\sigma\\
		-1 & \quad \text{otherwise}
	\end{cases} \quad \text{where } \ell=|n-\color{blue}\mu|$</div>
	<!--
	<div id="eqD_bimo4" style="display:none">
	<tab/>$\displaystyle \color{magenta}d(n) = \begin{cases}
		2 \left( 1 - (\delta / \color{blue}\sigma - 1)^2 \right)^\color{blue}\alpha - 1 & \quad \text{if } \delta \leq k \\
		-1 & \quad \text{otherwise}
	\end{cases} \quad \text{where } \delta=|n-\color{blue}\mu|, k=2\color{blue}\sigma^2$</div>
	-->
	<script>
	var deltaID = 0;
	var deltaName = ["gaus", "quad4", "trap", "stpz"];  //"bimo4"
	function DeltaFunc(n) {
		var r = Math.abs(n-delta_c);
		var r2 = r*r;
		switch (deltaID) {
			case 0: var k = 2*delta_w*delta_w; return Math.exp(-r2/k) * 2 - 1;  //gaus
			case 1: var k2 = 9*delta_w*delta_w; return r2>k2 ? -1 : Math.pow(1-r2/k2, kernel_A) * 2 - 1;  //quad4
			case 2: var p = delta_w/2, q = delta_w*2; return r<=p ? 1 : r<=q ? 2*(q-r)/(q-p)-1 : -1;  //trap
			case 3: return r<=delta_w ? 1 : -1;  //stpz
			//case 4: var k = 2*delta_w, m = r/delta_w - 1; return r>k ? -1 : Math.pow(1-m*m, kernel_A) * 2 * (n<delta_c?1:kernel_B[0]/B_DIV) - 1;  //bimo4
		}
	}
	</script>

	</td></tr><tr><td>
	<br>
	<hr>
	<u>Neighbor sum</u>: <!--<b>convolution</b> <i>(with circular kernel, using FFT)</i>--><br>
	<tab/>$\displaystyle \color{magenta}{k \ast f}(\mathbf x) = \frac{1}{N} \sum_{|\mathbf u| \leq 1} \color{magenta}k(\mathbf u) \color{magenta}f(\mathbf x + \mathbf u) \quad \text{where } N = \sum_{|\mathbf u| \leq 1} \color{magenta}k(\mathbf u)$<br>
	<!--
	$\quad \quad = (k \ast f) (\mathbf x) $<br>
	$\quad \quad = \mathcal F^{-1} ( \mathcal F (k) \cdot \mathcal F (f) ) (\mathbf x)$
	-->
	<table cellpadding=3 cellspacing=0>
	<tr><td width=150>
		<input type="button" class="btnDisplay" value="+" title="Increase cap of neighbor sum (alt+R)" onclick="actionKey=ALT+'R';this.blur();">
		<input type="button" class="btnDisplay" value="−" title="Decrease cap of neighbor sum (alt+T)" onclick="actionKey=ALT+'T';this.blur();">
		&nbsp; cap = <span id="txt_NCap" class="num"></span>
	</td></tr></table>

	</td></tr><tr><td>
	<u>Kernel</u>:
	<br>
	<table cellpadding=1 cellspacing=0 class="graphTable">
		<tr><td colspan="4">$k(\mathbf u)$</td></tr>
		<tr><td align="right" valign="top">1<td colspan="5" rowspan="2"><canvas id="graphK" class="graph"></canvas></td></tr>
		<tr><td align="right" valign="bottom">0</td><td valign="bottom">&nbsp; $r = |\mathbf u|$</td></tr>
		<tr><td> </td><td align="left" width="12.5%">1</td><td align="center" width="25%"></td><td align="center" width="25%">0</td><td align="center" width="25%"></td><td align="right" width="12.5%">1</td><td>&nbsp;$\mu m$</td></tr>
	</table>

	</td></tr><tr><td>
	<u>Kernel layer function</u>: <input type="button" class="btnRun" value="Switch" title="Switch kernel layer function (alt+W)" onclick="actionKey=ALT+'W';this.blur();">
	<span id="nameL_unmo" style="display:none"><b>unimodal</b></span>
	<span id="nameL_bimo" style="display:none"><b>bimodal</b> <i>(peak height $\color{blue}{\beta_{1..2}}$)</i></span>
	<span id="nameL_trmo" style="display:none"><b>trimodal</b> <i>(peak height $\color{blue}{\beta_{1..3}}$)</i></span>
	<span id="nameL_temo" style="display:none"><b>tetramodal</b> <i>(peak height $\color{blue}{\beta_{1..4}}$)</i></span>
	<input type="button" class="btnAddOff" value="Random" title="Random peak heights (Semicolon(;))" onclick="actionKey=SEMICOLON;this.blur();">
	<br>
	<div id="eqL_unmo" style="display:none">
	<tab/>$\displaystyle \color{magenta}k(\mathbf u) = \color{magenta}c(r) \quad \text{where } r=|\mathbf u|$</div>
	<div id="eqL_bimo" style="display:none">
	<tab/>$\displaystyle \color{magenta}k(\mathbf u) = \begin{cases}
		\color{blue}{\beta_1} \cdot \color{magenta}c(2r)     & \quad \text{if } r \le 1/2\\
		\color{blue}{\beta_2} \cdot \color{magenta}c(2r - 1) & \quad \text{if } 1/2 \le r \le 1
	\end{cases} \quad \text{where } r=|\mathbf u|$</div>
	<div id="eqL_trmo" style="display:none">
	<tab/>$\displaystyle \color{magenta}k(\mathbf u) = \begin{cases}
		\color{blue}{\beta_1} \cdot \color{magenta}c(3r)     & \quad \text{if } r \le 1/3\\
		\color{blue}{\beta_2} \cdot \color{magenta}c(3r - 1) & \quad \text{if } 1/3 \le r \le 2/3\\
		\color{blue}{\beta_3} \cdot \color{magenta}c(3r - 2) & \quad \text{if } 2/3 \le r \le 1
	\end{cases} \quad \text{where } r=|\mathbf u|$</div>
	<div id="eqL_temo" style="display:none">
	<tab/>$\displaystyle \color{magenta}k(\mathbf u) = \begin{cases}
		\color{blue}{\beta_1} \cdot \color{magenta}c(4r)     & \quad \text{if } r \le 1/4\\
		\color{blue}{\beta_2} \cdot \color{magenta}c(4r - 1) & \quad \text{if } 1/4 \le r \le 2/4\\
		\color{blue}{\beta_3} \cdot \color{magenta}c(4r - 2) & \quad \text{if } 2/4 \le r \le 3/4\\
		\color{blue}{\beta_4} \cdot \color{magenta}c(4r - 3) & \quad \text{if } 3/4 \le r \le 1
	\end{cases} \quad \text{where } r=|\mathbf u|$</div>
	<script>
	var layerID = 0;
	var layerName = ["unmo", "bimo", "trmo", "temo"];
	function KernelFunc(r) {
		r = Math.abs(r);
		if (layerID==0)
			return CoreFunc(r);
		else {
			if (r>=1) return 0;
			/*
			var R = r * (layerID+1);
			var b = Math.floor(R);
			return (r<=1) ? CoreFunc(R-b) * kernel_B[b]/B_DIV : 0;
			*/
			var R = r * (layerID+1);
			var b = Math.floor(R);
			var e = Math.floor(R+1/2);
			var kE = (e<=layerID) ? kernel_E[e] : 0;
			return CoreFunc(R % 1) * (kernel_B[b]-kE)/B_DIV + kE/B_DIV;
		}
	}
	/*
	R R+1/2
	0 0 x*(B0-E0)+E0
	0 1 x*(B0-E1)+E1
	1 1 x*(B1-E1)+E1
	1 2 x*(B1-E2)+E2
	2 2 x*(B2-E2)+E2
	2 3 x*(B2)
	*/
	</script>

	</td></tr><tr><td>
	<u>Kernel core function</u>: <input type="button" class="btnRun" value="Switch" title="Switch kernel core function (alt+E)" onclick="actionKey=ALT+'E';this.blur();">
	<span id="nameC_bump4" style="display:none"><b>Gaussian bump</b> <i>(raised to the power $\color{blue}\alpha$)</i></span>
	<span id="nameC_quad4" style="display:none"><b>polynomial</b> <i>(raised to the power $\color{blue}\alpha$)</i></span>
	<!--<span id="nameC_cosp4" style="display:none"><b>cosine</b> <i>(raised to the power $\color{blue}\alpha$)</i></span>-->
	<span id="nameC_trap1/5" style="display:none"><b>trapezoidal</b> <i>(5 equal portions)</i></span>
	<span id="nameC_stpz1/4" style="display:none"><b>step</b> <i>(for SmoothLife, outer radius = inner radius &times; 3)</i></span>
	<span id="nameC_life" style="display:none"><b>high step</b> <i>(for Conway's Game of Life)</i></span>
	<!--<span id="nameC_life2" style="display:none"><b>high Gaussian</b> <i>()</i></span>-->
	<br>
	<div id="eqC_bump4" style="display:none">
	<tab/>$\displaystyle \color{magenta}c(r) = e^{\color{blue}\alpha ( 1 - 1 / k )} \quad \text{where } k=4 r (1-r)$</div>
	<div id="eqC_quad4" style="display:none">
	<tab/>$\displaystyle \color{magenta}c(r) = k^\color{blue}\alpha \quad \text{where } k=4 r (1-r)$</div>
	<div id="eqC_trap1/5" style="display:none">
	<tab/>$\displaystyle \color{magenta}c(r) = \begin{cases}
		(r-q) / q & \quad \text{if } q \leq r \leq 2q\\
		1 & \quad \text{if } 2q \leq r \leq 1-2q\\
		(1-q-r) / q & \quad \text{if } 1-2q \leq r \leq 1-q\\
		0 & \quad \text{otherwise}
	\end{cases} \quad \text{where } q=1/5$</div>
	<div id="eqC_stpz1/4" style="display:none">
	<tab/>$\displaystyle \color{magenta}c(r) = \begin{cases}
		1 & \quad \text{if } q \leq r \leq 1-q\\
		0 & \quad \text{otherwise}
	\end{cases} \quad \text{where } q=1/4$</div>
	<div id="eqC_life" style="display:none">
	<tab/>$\displaystyle \color{magenta}c(r) = \begin{cases}
		1 & \quad \text{if } q \leq r \leq 1-q\\
		1/2 & \quad \text{if } r \leq q\\
		0 & \quad \text{otherwise}
	\end{cases} \quad \text{where } q=1/4$</div>
	<!--
	<div id="eqK_cosp4" style="display:none">
	<tab/>$\displaystyle k(\mathbf u) = | \cos^\color{blue}\alpha (\pi r + \pi/2)| \quad \text{where } r=|\mathbf u|$</div>
	-->
	<script>
	var coreID = 0;
	var coreName = ["bump4", "quad4", "trap1/5", "stpz1/4", "life"]; //"cosp4", "trap1/4/4", "life2"
	function CoreFunc(r) {
		switch (coreID) {
			case 0: return (r>1) ? 0 : Math.exp(kernel_A - kernel_A/4/r/(1-r));  //bump4
			case 1: return (r>1) ? 0 : Math.pow(4*r*(1-r), kernel_A);  //quad4
			case 2: var q = 1/5; return (r<q||r>1-q) ? 0 : (r<2*q) ? (r-q)/q : (r>1-2*q) ? (1-q-r)/q : 1;  //trap1/5
			case 3: var q = 1/4; return (r>=q&&r<=1-q) ? 1 : 0;  //stpz1/4
			case 4: var q = 1/4; return (r<q) ? 0.5 : (r>1-q) ? 0 : 1;  // life
			//case : return Math.abs(Math.pow(Math.cos((r+0.5)*π), kernel_A));  // cosp4
			//case : var q = 1/5, d = 1/5; return r<q ? 0 : r<q+d ? (r-q)/d : r>1-d ? (1-r)/d : 1;  // trap1/4/4
			//case : return (r<1/2 ? 2/3 : 1) * Math.exp(kernel_A - kernel_A/(1-(2*r-1)*(2*r-1))) + (r<1/2 ? 1/3 : 0);  // life2
		}
	}
	</script>
	<table cellpadding=3 cellspacing=0>
	<tr><td width=150>
		<input type="button" value="+" title="Increase stiffness of kernel core function" onclick="actionKey=INT+1;this.blur();">
		<input type="button" value="−" title="Decrease stiffness of kernel core function" onclick="actionKey=INT+2;this.blur();">
		&nbsp; $\color{blue}\alpha$ = <span id="txt_A" class="num"></span>
	</td></tr></table>

	</td></tr><tr><td>
	<br>
	<hr>
	<u>Statistics</u><br>
	raw geometric moments $\displaystyle m_{pq} = \sum_{x,y} x^p y^q f(x, y)$<br>
	central moments $\displaystyle \mu_{pq} = \sum_{x,y} (x-\bar x)^p (y-\bar y)^q f(x, y)$<br>
	<!--
	<tab/><tab/>$\displaystyle = \sum_{r=0}^p \sum_{s=0}^q \binom{p}{r} \binom{q}{s} (-\bar x)^{p-r} (-\bar y)^{q-s} m_{rs}$<br>
	<tab/>$\displaystyle \mu_{00} = m_{00}, \mu_{10} = \mu_{01} = 0$<br>
	normalized central moments<br>
	<tab/>$\displaystyle \eta_{pq} = \mu_{pq} / \mu_{00}^\gamma \quad \text{where } \gamma = \frac{p+q}{2}+1, p+q \geq 2$<br>
	-->
	complex moments $\displaystyle c_{pq} = \sum_{x,y} (x+iy)^p (x-iy)^q f(x, y)$<br>
	mass $m = m_{00}$, centroid $\displaystyle \bar\mathbf x = (\bar x, \bar y) = (\frac{m_{10}}{m_{00}}, \frac{m_{01}}{m_{00}})$<br>
	<!--<tab/><tab/>$\displaystyle = \sum_{r=0}^p \sum_{s=0}^q \binom{p}{r} \binom{q}{s} (-1)^{q-s} (i)^{p+q-r-s} m_{r+s,p+q-r-s}$<br>-->

	<hr>
	</td></tr></table>

</DIV>
</TD>
<TD id="CubePanel" valign="top" class="scrollOut" style="display:none">
<DIV class="scrollIn">

	<br>
	<div class="scrollIn">
	<table cellpadding=3 cellspacing=0>
	<tr><td>Mark status as:</td><td>
	<input type="button" class="btnSoliton" value="Found" title="Mark current &beta; set as soliton found (P)" onclick="actionKey='P';this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="Missing" title="Mark current &beta; set as missing i.e. soliton not found (shift+P)" onclick="actionKey='P';actionShift=true;this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="Empty" title="Mark current &beta; set as empty i.e. status unknown (alt+P)" onclick="actionKey=ALT+'P';this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="Empty all" title="Mark all &beta; sets as empty (alt+Y)" onclick="actionKey=ALT+'Y';this.blur();"> &nbsp;
	<input type="button" class="btnSoliton" value="Empty&rarr;Missing" title="Mark all empty &beta; sets as missing (alt+H)" onclick="actionKey=ALT+'H';this.blur();"> &nbsp;
	</tr></table>
	<table cellpadding=0 cellspacing=0 id="CubeTable" class="cubeTable">
	</table>
	</div>

</DIV>
</TD>
<TD id="PlotPanel" valign="top" class="scrollOut" style="display:none">
<DIV class="scrollIn">

	<br>
	<div class="scrollIn">
	<table cellpadding=3 cellspacing=0>
	<tr><td>Plot 3D surface: 
		<input type="button" class="btnDisplay" value="Clear" title="Clear the 3D surface plot (alt+U)" onclick="actionKey=ALT+'U';this.blur();"> &nbsp;
		<input type="button" class="btnDisplay" value="Field" title="Plot 3D surface of field (alt+I)" onclick="actionKey=ALT+'I';this.blur();"> &nbsp;
		<input type="button" class="btnDisplay" value="Delta" title="Plot 3D surface of delta (alt+O)" onclick="actionKey=ALT+'O';this.blur();"> &nbsp;
		<input type="button" class="btnDisplay" value="Neigh" title="Plot 3D surface of neighbor sum (alt+K)" onclick="actionKey=ALT+'K';this.blur();"> &nbsp;
		<input type="button" class="btnDisplay" value="Kernel" title="Plot 3D surface of kernel (alt+L)" onclick="actionKey=ALT+'L';this.blur();"> &nbsp;
		&nbsp; Plot 3D line:
		<input type="button" class="btnDisplay" value="Stats" title="Plot 3D line of stats (alt+J)" onclick="actionKey=ALT+'J';this.blur();">
	</td></tr>
	<tr><td>
		<div id="PlotDiv" class="plotDiv"></div>
	</td><td>
		Stats axes:<br><br>
		<table cellpadding=0 cellspacing=0>
		<tr><td><input type="checkbox" id="cb0"  onclick="StatCheckBox()"></td><td>$\color{black}m$</td><td>Mass</td></tr>
		<tr><td><input type="checkbox" id="cb1"  onclick="StatCheckBox()"></td><td>$\color{black}g$</td><td>Growth</td></tr>
		<tr><td><input type="checkbox" id="cb2"  onclick="StatCheckBox()"></td><td>$\color{black}V$</td><td>Mass volume</td></tr>
		<tr><td><input type="checkbox" id="cb3"  onclick="StatCheckBox()"></td><td>$\color{black}{V_g}$</td><td>Growth volume</td></tr>
		<tr><td><input type="checkbox" id="cb4"  onclick="StatCheckBox()"></td><td>$\color{black}\rho$</td><td>Mass density</td></tr>
		<tr><td><input type="checkbox" id="cb5"  onclick="StatCheckBox()"></td><td>$\color{black}{\rho_g}$</td><td>Growth density</td></tr>
		<tr><td><input type="checkbox" id="cb6"  onclick="StatCheckBox()"></td><td>$\color{black}s$</td><td>Centroid speed</td></tr>
		<tr><td><input type="checkbox" id="cb7"  onclick="StatCheckBox()"></td><td>$\color{black}{d_g}$</td><td>Growth-centroid distance</td></tr>
		<tr><td><input type="checkbox" id="cb8"  onclick="StatCheckBox()"></td><td>$\color{black}\omega$</td><td>Centroid rotate speed</td></tr>
		<tr><td><input type="checkbox" id="cb9"  onclick="StatCheckBox()"></td><td>$\color{black}{\omega_g}$</td><td>Growth-centroid rotate speed</td></tr>
		<tr><td><input type="checkbox" id="cb10" onclick="StatCheckBox()"></td><td>$\color{black}{\omega_\theta}$</td><td>Major axis rotate speed</td></tr>
		<tr><td><input type="checkbox" id="cb11" onclick="StatCheckBox()"></td><td>$\color{black}I$</td><td>Moment of inertia &sim; Hu's 1</td></tr>
		<tr><td><input type="checkbox" id="cb12" onclick="StatCheckBox()"></td><td>$\color{black}\gamma$</td><td>Skewness &sim; Hu's 4</td></tr>
		<tr><td><input type="checkbox" id="cb13" onclick="StatCheckBox()"></td><td>$\color{black}{\phi_5}$</td><td>Hu's 5</td></tr>
		<tr><td><input type="checkbox" id="cb14" onclick="StatCheckBox()"></td><td>$\color{black}{\phi_6}$</td><td>Hu's 6</td></tr>
		<tr><td><input type="checkbox" id="cb15" onclick="StatCheckBox()"></td><td>$\color{black}{\phi_7}$</td><td>Hu's 7</td></tr>
		<tr><td><input type="checkbox" id="cb16" onclick="StatCheckBox()"></td><td>$\color{black}\kappa$</td><td>Kurtosis &sim; Flusser's 7</td></tr>
		<tr><td><input type="checkbox" id="cb17" onclick="StatCheckBox()"></td><td>$\color{black}{\psi_8}$</td><td>Flusser's 8</td></tr>
		<tr><td><input type="checkbox" id="cb18" onclick="StatCheckBox()"></td><td>$\color{black}{\psi_9}$</td><td>Flusser's 9</td></tr>
		<tr><td><input type="checkbox" id="cb19" onclick="StatCheckBox()"></td><td>$\color{black}{\psi_{10}}$</td><td>Flusser's 10</td></tr>
		</table>
	</td></tr></table>

</DIV>
</TD>
<TD id="StatPanel" valign="top" class="scrollOut" style="display:none">
<DIV class="scrollIn">

	<br>
	<div class="scrollIn">
	<table cellpadding=0 cellspacing=0>
	<tr id="s_tr0" ><td><canvas id="stat0"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val0"  class="val"></div></td><td>Mass (log scale)<br><tab/>$\color{black}m = \sum f(\mathbf x) / R^2 \quad [\mu g]$</td></tr>
	<tr id="s_tr1" ><td><canvas id="stat1"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val1"  class="val"></div></td><td>Growth (log scale)<br><tab/>$\color{black}g = \sum_{d>0} d(n(\mathbf x)) / R^2 \quad [\mu g / \mu s]$</td></tr>
	<tr id="s_tr2" ><td><canvas id="stat2"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val2"  class="val"></div></td><td>Mass volume (log scale)<br><tab/>$\color{black}V = \sum_{f>0} 1 / R^2 \quad [\mu m^2]$</td></tr>
	<tr id="s_tr3" ><td><canvas id="stat3"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val3"  class="val"></div></td><td>Growth volume (log scale)<br><tab/>$\color{black}{V_g} = \sum_{d>0} 1 / R^2 \quad [\mu m^2]$</td></tr>
	<tr id="s_tr4" ><td><canvas id="stat4"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val4"  class="val"></div></td><td>Mass density<br><tab/>$\color{black}\rho = m / V \quad [\mu g / \mu m^2]$</td></tr>
	<tr id="s_tr5" ><td><canvas id="stat5"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val5"  class="val"></div></td><td>Growth density<br><tab/>$\color{black}{\rho_g} = g / V_g \quad [\mu g / (\mu m^2 \cdot \mu s)]$</td></tr>
	<tr id="s_tr6" ><td><canvas id="stat6"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val6"  class="val"></div></td><td>Centroid speed <span style="color:#f70">&#9679;&rarr;</span><br><tab/>$\color{black}s = (|\Delta \bar\mathbf x_m| / R) / \Delta t \quad [\mu m / \mu s]$</td></tr>
	<tr id="s_tr7" ><td><canvas id="stat7"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val7"  class="val"></div></td><td>Growth-centroid distance <span style="color:#ff0">&#9679;</span><br><tab/>$\color{black}{d_g} = |\bar\mathbf x_g - \bar\mathbf x_m| / R \quad [\mu m]$</td></tr>
	<tr id="s_tr8" ><td><canvas id="stat8"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val8"  class="val"></div></td><td>Centroid rotate speed<br><tab/>$\color{black}\omega = \arg(\Delta \bar\mathbf x_m) / \Delta t \quad [rad / \mu s]$</td></tr>
	<tr id="s_tr9" ><td><canvas id="stat9"  class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val9"  class="val"></div></td><td>Growth-centroid rotate speed<br><tab/>$\color{black}{\omega_g} = \Delta \arg(\bar\mathbf x_g - \bar\mathbf x_m) / \Delta t \quad [rad / \mu s]$</td></tr>
	<tr id="s_tr10"><td><canvas id="stat10" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val10" class="val"></div></td><td>Major axis rotate speed<br><tab/>$\color{black}{\omega_\theta} = \Delta (1/2 \arctan (^{2 \mu_{11}} / _{\mu_{20} - \mu_{02}}) ) / \Delta t \quad [rad / \mu s]$</td></tr>
	<tr id="s_tr11"><td><canvas id="stat11" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val11" class="val"></div></td><td>Moment of inertia &sim; Hu's moment invariant 1 (log scale)<br><tab/>$\color{black}I \sim \varphi_1 = c_{11}$</td></tr>
	<tr id="s_tr12"><td><canvas id="stat12" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val12" class="val"></div></td><td>Skewness &sim; Hu's 4 (log scale)<br><tab/>$\color{black}\gamma \sim \varphi_4 = c_{21}c_{12}$</td></tr>
	<tr id="s_tr13"><td><canvas id="stat13" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val13" class="val"></div></td><td>Hu's 5 (log scale)<br><tab/>$\color{black}{\varphi_5} = \text{Re}(c_{30}c_{12}^3)$</td></tr>
	<tr id="s_tr14"><td><canvas id="stat14" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val14" class="val"></div></td><td>Hu's 6 (log scale)<br><tab/>$\color{black}{\varphi_6} = \text{Re}(c_{20}c_{12}^2)$</td></tr>
	<tr id="s_tr15"><td><canvas id="stat15" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val15" class="val"></div></td><td>Hu's 7 (log scale)<br><tab/>$\color{black}{\varphi_7} = \text{Im}(c_{30}c_{12}^3)$</td></tr>
	<tr id="s_tr16"><td><canvas id="stat16" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val16" class="val"></div></td><td>Kurtosis &sim; Flusser's moment invariant 7<br><tab/>$\color{black}\kappa \sim \psi_7 = c_{22}$</td></tr>
	<tr id="s_tr17"><td><canvas id="stat17" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val17" class="val"></div></td><td>Flusser's 8 (log scale)<br><tab/>$\color{black}{\psi_8} = \text{Re}(c_{31}c_{12}^2)$</td></tr>
	<tr id="s_tr18"><td><canvas id="stat18" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val18" class="val"></div></td><td>Flusser's 9 (log scale)<br><tab/>$\color{black}{\psi_9} = \text{Im}(c_{31}c_{12}^2)$</td></tr>
	<tr id="s_tr19"><td><canvas id="stat19" class="stat" onclick="SelectStatObj(this)"></canvas></td><td><div id="val19" class="val"></div></td><td>Flusser's 10 (log scale)<br><tab/>$\color{black}{\psi_{10}} = \text{Re}(c_{40}c_{12}^4)$</td></tr>
	<tr><td colspan=3>Period candidates: <span id="txt_periods"></span></td></tr>
	<!--
	<tr><td>$I = \sum f \cdot |\mathbf x|^2 / R^2$<br>Moment of inertia</td><td></td></tr>
	<tr><td>$\bar\mathbf x_c = \sum f \cdot \mathbf x / \sum f$<br>Center of mass</td><td></td></tr>
	<tr><td><canvas id="s12" class="stat"></canvas></td><td></td><td>Gyration radius<br><tab/>$k = \sqrt{I/m} \quad \text{where } I = \sum f(\mathbf x) |\mathbf x|^2 / R^2$</td></tr>
	<tr id="s_tr19" onclick="SelectStatObj(this)"><td><canvas id="stat19" class="stat"></canvas></td><td><div id="val19" class="val"></div></td><td>Flusser's 11 (log scale)<br><tab/>$\color{black}{\psi_{11}} = \text{Im}(c_{40}c_{12}^4)$</td></tr>
	-->
	</table>
	</div>

	<!--
	</TD><TD id="GifPanel" valign="top" style="display:none">

	<br>
	<table cellpadding=5 cellspacing=0>
	<tr>
	<td><img src="gif/Orbium2.png" class="gif" onmouseover="LoadGif(this)" onmouseout="UnloadGif(this)"></td>
	<td><img src="gif/Choreoptera.png" class="gif" onmouseover="LoadGif(this)" onmouseout="UnloadGif(this)"></td>
	</tr>
	<tr>
	<td><i>Orbium</i></td>
	<td><i>Choreoptera</i></td>
	</tr>
	</table>
	-->

</DIV>
</TD>
</TR>
</TABLE>

</TD>
</TR>
</TABLE>
<script src="main.js"></script>
</BODY>
</HTML>
